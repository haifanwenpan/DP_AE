# DP Automotive Extension Services Architecture Specification

## Function of Profile 0

| AE Spec<br>Feature                                                        |  RTL change plan                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Normative shall be <br>implemented  | Note                                                                                                                                                                                                          |
|---------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Uncompressed Pixel Frame CRC or Reconstructed Pixel CRC per Slice Column  | CRC-32 engine<br>48-bit container for each pixel                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Normative                           | 4 pipe 48bit(192 bit)  CRC-32                                                                                                                                                                                 |
| Compressed Pixel Frame CRC                                                | CRC-32 engine<br>data repacker for 48-bit container                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Optional                            |                                                                                                                                                                                                               |
| CRC on defined SDPs                                                       | CRC-32 engine<br>data repacker for 48-bit container<br>SDP Types to be used in CRC_SDP_DATA calculation <br>01h <br>02h <br>04h <br>05h <br>06h <br>07h <br>0Fh through 08h <br>10h <br>11h <br>20h (VSC_EXT_VESA except AE_SDP)<br>21h <br>87h through 81h                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Normative                           | A split SDP may start transmission in HBlank during the vertical active period of Frame N-1,  and complete in vertical blank period of Frame N.  Such an SDP would belong to the context of AE SDP Frame N-1. |
| AE_SDP/CRC on AE_SDP                                                      | Buffer for AE_SDP chain<br>CRC-32 engine<br>data repacker for 48-bit container                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Normative                           | AE_SDP is distinguished from other VSC_EXT_VESA via DB3 and DB4                                                                                                                                               |
| CRC on MSA                                                                | CRC-32 engine<br>data repacker for 48-bit container                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Normative                           |                                                                                                                                                                                                               |
| CRC on Regions-of-Interest Support (Max <br>16)                           | CRC-32 engine<br>48-bit container for each pixel<br>Hcnt, Vcnt for ROI                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Normative                           | ROI Region Overlap Four Times may require 4 parallel CRC engines<br>4 parallel CRC engines are enough for all ROI CRC calculations<br>We can just use 16 parallel CRC engines<br>what is “Min ROI Req of 0” ? |
| Frame drop/repeat and <br>timeout monitoring check                        | FSM                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Normative                           |                                                                                                                                                                                                               |
| CRC, Frame ID, and Timeout checks                                         | FSM                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Normative                           |                                                                                                                                                                                                               |
| DPCD                                                                      | 00A00h to 00A09h  :  DP AE Interrupt Registers <br>00A10h to 00A13h  :  VESA AE DPCD Capabilities - Safety <br>00A20h to 00A21h  :  VESA AE DPCD Capabilities - Security <br>00A2Ah            :  VESA AE DPCD Capabilities - Superframe <br>00A30h to 00A52h  :  VESA AE DPCD Configuration - Safe State <br>00A60h to 00A80h  :  VESA AE DPCD Configuration – Superframe <br>00A90h to 00B11h  :  VESA AE DPCD Configuration - ROI <br>00B20h            :  VESA AE DPCD Functional State Status <br>00B30h to 0B34h   :  VESA AE Security Status <br>00B40h to 00B4Ah  :  VESA AE DPCD Status - FRAME_ID <br>00B50h to 00B58h  :  DPCD Sink AE_SDP Status Compare <br>00B60h to 00B65h  :  DPCD Sink AE_SDP Debug Registers  | Normative                           | 358 DPCD regs total, may need new page                                                                                                                                                                        |
| DP AE Safety Self-Test                                                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Optional                            | The DP Sink device may not display any test pattern information on the screen during this initialization.<br>How does sink recognize this state                                                               |
| Super Frames                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Optional                            | Branch should support                                                                                                                                                                                         |

## Main State

![Main State Diagram](pic/M_STATE.drawio.png "Main State Diagram")

| Main State/Event                                   |  Description                                                                                                                                                                                                                                                                                         |
|----------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| M_S0:STATE_0_AE_DEVICE_CAP_STATUS                  | Set the status bit AE_DEVICE_CAP_STATUS = 0                                                                                                                                                                                                                                                          |
| M_S1:STATE_2_AE_SDP_RX_STATUS                      | Set the status bit AE_DEVICE_CAP_STATUS = 1                                                                                                                                                                                                                                                          |
| M_S2:STATE_3A_WAIT_AE_SDP_FUSA_COMPARE_ENABLE<br>D | Setting status bit AE_SDP_RX_STATUS = 1                                                                                                                                                                                                                                                              |
| M_S3                                               | 1st FUSA_COMPARE = 1 received                                                                                                                                                                                                                                                                        |
| M_S4                                               | 2nd FUSA_COMPARE = 1 received                                                                                                                                                                                                                                                                        |
| M_S5:STATE_4_PROTECTED                             | 3rd FUSA_COMPARE = 1 received<br>Set the AE_SDP_FUSA_COMPARE_ENABLED = 1<br>CRC, Frame ID, Frame drop/repeat and timeout monitoring check<br>ROI CRC check based on the ROI_MASK of the previous 2, the previous 1 and current frame<br>Soft Failure Fault Detection<br>Hard Failure Fault Detection |
| Transition from<br>any State to M_S0               | Train state is not MNORMAL<br>No jump when VFAIL?                                                                                                                                                                                                                                                    |
| Transition M_S0:M_S1                               | Train state is MNORMAL                                                                                                                                                                                                                                                                               |
| Transition M_S1:M_S2                               | FUSA_COMPARE = 0 received                                                                                                                                                                                                                                                                            |
| Transition M_S2:M_S3                               | 1st FUSA_COMPARE = 1 received                                                                                                                                                                                                                                                                        |
| Transition M_S3:M_S4                               | 2nd FUSA_COMPARE = 1 received                                                                                                                                                                                                                                                                        |
| Transition M_S4:M_S5                               | 3rd FUSA_COMPARE = 1 received                                                                                                                                                                                                                                                                        |
| Transition M_S5:M_S2                               | FUSA_COMPARE = 0 received                                                                                                                                                                                                                                                                            |
| Transition M_S3,M_S4:M_S2                          | AE_SDP loss<br>FUSA_COMPARE = 0 received                                                                                                                                                                                                                                                             |

## AE_SDP Chain Update State

![Main State Diagram](pic/AE_SDP.drawio.png "Main State Diagram")

| AE_SDP Chain update State/Event      |  Description                                                                                                                                  |
|--------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------|
| A_S0                                 | IDLE                                                                                                                                          |
| A_S1                                 | 1st AE_SDP received<br>Waiting other AE_SDP chain<br>Latch AE_DPCD config                                                                     |
| A_S2                                 | AE_SDP valid and update                                                                                                                       |
| A_S3                                 | AE_SDP error                                                                                                                                  |
| Transition from<br>any State to A_S0 | Main State is M_S0                                                                                                                            |
| Transition A_S0:A_S1                 | 1st AE_SDP received<br>Check HB1(20h), HB2[7](MIDDLE_OF_CHAINING=1) && !C_S2, HB3[4:0](Packet Sequence =0）<br>DB0,DB1,DB2,DB3,DB4<br>DB5,DB6 |
| Transition A_S1:A_S2                 | AE_SDP chain finished normally<br>Check HB1(20h), HB2[7](MIDDLE_OF_CHAINING=0), HB3[4:0](Packet Sequence == (1 + INT( <br>(4N+ 4NR+3) /32)）  |
| Transition A_S1:A_S3                 | AE_SDP chain error<br>Packet Sequence mismatch<br>HB2[7](MIDDLE_OF_CHAINING=0), HB3[4:0](Packet Sequence != (1 + INT( <br>(4N+ 4NR+3) /32)）  |
| Transition A_S2,A_S3:A_S0            | vcnt==1, 1st active line                                                                                                                      |
| AE_SDP_DATA_LATCH                    | A_S0 exit to A_S1<br>VSC_EXT_VESA_UPDATE && A_S1)                                                                                             |
| AE_DPCD_UPDATE                       | A_S1 entry                                                                                                                                    |
| AE_SDP_UPDATE                        | A_S2 entry                                                                                                                                    |
| AE_SDP_LOSS                          | (vcnt==1) && A_S0 \|\| A_S3 entry                                                                                                             |
| AE_SDP_CRC caculate start            | A_S1 entry                                                                                                                                    |
| ALL_CRC_CHECK                        | AE_SDP_CRC caculate done                                                                                                                      |
